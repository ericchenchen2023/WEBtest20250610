<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>æ™ºèƒ½åŒè¯­ç¿»è¯‘ä¸è¯æ±‡å­¦ä¹ å·¥å…·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background-color: #f9f9f9;
      color: #333;
    }
    h1 {
      color: #222;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      width: 100%;
      margin-bottom: 20px;
    }
    .translation {
      display: flex;
      flex-direction: row;
      margin-bottom: 20px;
      background-color: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .en, .zh, .vocab {
      width: 33%;
      padding: 10px;
      vertical-align: top;
    }
    .image-section img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    ul {
      list-style-type: square;
      padding-left: 20px;
    }
    li {
      margin-bottom: 5px;
    }
    .audio-btn {
      margin-top: 10px;
      cursor: pointer;
      color: #007BFF;
      text-decoration: underline;
    }
    .source-link {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1>ğŸŒ æ™ºèƒ½åŒè¯­ç¿»è¯‘ä¸è¯æ±‡å­¦ä¹ å·¥å…·</h1>

<input type="text" id="urlInput" placeholder="è¯·è¾“å…¥ chinadaily æ–‡ç« é“¾æ¥" />

<button onclick="generateContent()">ç”Ÿæˆå†…å®¹</button>

<div class="source-link" id="sourceLink"></div>
<div id="contentArea"></div>

<script>
  async function generateContent() {
    const url = document.getElementById("urlInput").value.trim();
    if (!url) {
      alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€");
      return;
    }

    const contentArea = document.getElementById("contentArea");
    const sourceLink = document.getElementById("sourceLink");

    contentArea.innerHTML = "<p>æ­£åœ¨åŠ è½½å†…å®¹...</p>";
    sourceLink.innerHTML = "";

    try {
      const res = await fetch("https://webtest20250610-production.up.railway.app",  {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url })
      });

      const data = await res.json();
      renderContent(data);
      sourceLink.innerHTML = `<p>ğŸ”— æŸ¥çœ‹åŸæ–‡ï¼š<a href="${data.sourceUrl}" target="_blank">${data.sourceUrl}</a></p>`;
    } catch (e) {
      contentArea.innerHTML = `<p style="color:red;">åŠ è½½å¤±è´¥: ${e.message}</p>`;
    }
  }

  function renderContent(data) {
    const contentArea = document.getElementById("contentArea");
    contentArea.innerHTML = "";

    data.translations.forEach(item => {
      const div = document.createElement("div");
      div.className = "translation";

      div.innerHTML = `
        <div class="en">${item.en}<br><span class="audio-btn" onclick="speak('${item.en.replace(/'/g, "\\'")}', 'en')">ğŸ”Š è‹±æ–‡æœ—è¯»</span></div>
        <div class="zh">${item.zh}<br><span class="audio-btn" onclick="speak('${item.zh.replace(/'/g, "\\'")}', 'zh')">ğŸ”Š ä¸­æ–‡æœ—è¯»</span></div>
        <div class="vocab">
          <ul>
            ${item.vocab.map(word => `<li><strong>${word}</strong> â€” ${getWordDetail(word)}</li>`).join("")}
          </ul>
        </div>
      `;
      contentArea.appendChild(div);
    });

    if (data.images && data.images.length > 0) {
      const imageSection = document.createElement("div");
      imageSection.className = "image-section";
      imageSection.innerHTML = "<h2>ğŸ–¼ï¸ åŸæ–‡é…å›¾</h2>";
      data.images.forEach(imgUrl => {
        const img = document.createElement("img");
        img.src = imgUrl;
        img.alt = "åŸæ–‡å›¾ç‰‡";
        img.onerror = () => img.style.display = 'none';
        imageSection.appendChild(img);
      });
      contentArea.appendChild(imageSection);
    }
  }

  function getWordDetail(word) {
    const details = {
      participants: "/pÉ‘ËrËˆtÉªsÉªpÉ™nts/ â€” å‚ä¸è€…",
      multisport: "/ËŒmÊŒltiËˆspÉ”Ërt/ â€” å¤šé¡¹è¿åŠ¨",
      autonomous: "/É”ËËˆtÉ’nÉ™mÉ™s/ â€” è‡ªæ²»çš„",
      maneuvering: "/mÉ™ËˆnjuËvÉ™rÉªÅ‹/ â€” æ“ä½œã€æ“æ§",
      challenging: "/ËˆtÊƒÃ¦lÉªndÊ’ÉªÅ‹/ â€” å¯Œæœ‰æŒ‘æˆ˜æ€§çš„",
      contestants: "/kÉ™nËˆtestÉ™nts/ â€” å‚èµ›è€…",
      rapids: "/ËˆrÃ¦pÉªdz/ â€” æ€¥æµ"
    };
    return details[word] || "";
  }

  function speak(text, lang) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang === "en" ? "en-US" : "zh-CN";
    speechSynthesis.speak(utterance);
  }
</script>

</body>
</html>
